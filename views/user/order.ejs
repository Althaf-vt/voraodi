<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VOGUE - My Orders</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.11.5/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.11.5/ScrollTrigger.min.js"></script>
    <link rel="stylesheet" href="/user/ordersStyle.css">
    <link rel="stylesheet" href="/user/footerStyle.css">
</head>
<body>
    <%- include('../../views/partials/user/header') %>

    <div class="orders-container">
        <div class="orders-header">
            <div class="profile-section">
                <img src="<%= user.image %>" alt="Profile" class="profile-image">
                <div class="profile-text">
                    <h1>ORDER HISTORY <span><%= user.name %></span></h1>
                    <p>Track, return, or cancel orders</p>
                </div>
            </div>
            <div class="orders-filter">
                <span>Filter:</span>
                <select>
                    <option>All Orders</option>
                    <option>Last 30 Days</option>
                    <option>Past Year</option>
                </select>
            </div>
        </div>

        <div class="orders-content">
            <% if (orders && orders.length > 0) { %>
                <div class="orders-grid">
                    <% orders.forEach(order => { %>
                        <div class="order-card">
                            <div class="order-card-header">
                                <div class="order-meta">
                                    <span class="order-id">
                                        <%= order.orderedItems[0].product.productName %>
                                        <% if( order.orderedItems[1]?.product?.productName && order.orderedItems[0].product.productName !== order.orderedItems[1].product.productName) {%>
                                        <% if(order?.orderedItems[1]?.product.productName) {%>,<% } %>
                                        <%= order?.orderedItems[1]?.product.productName %>
                                        <% } %>
                                    <% if(order.orderedItems[1]?.product?.productName && order.orderedItems[0].product.productName !== order.orderedItems[1].product.productName && order.orderedItems.length > 2 ){%>
                                        ...    
                                    <% } %>
                                    </span>
                                    <span class="order-date"><%= new Date(order.invoiceDate).toLocaleDateString() %></span>
                                </div>
                                <span class="order-status <%= order.status.toLowerCase().replace(' ', '-') %>">
                                    <%= order.status %>
                                </span>
                            </div>
                            
                            <div class="order-card-body">
                                <div class="order-summary">
                                    <div class="order-total">
                                        <span>Total</span>
                                        <strong>â‚¹<%= order.finalAmount.toFixed(2) %></strong>
                                    </div>
                                    <% if (order.orderedItems && order.orderedItems.length > 0) { %>
                                        <div class="order-items-count">
                                            <span><%= order.orderedItems[0].quantity %> Item(s)</span>
                                        </div>
                                    <% } %>
                                </div>
                            </div>
                            
                            <div class="order-card-footer">
                                <% if(order.status !== 'Payment Failed') {%>

                                <a href="/order-details/<%= order.orderId %>" class="view-details-button">
                                    View Details <i class="fas fa-chevron-right"></i>
                                </a>
                                    <% } else{%>
                                        <a href="/checkout?orderId=<%= order.orderId %>" class="retry-payment-button">
                                            Retry Payment <i class="fas fa-chevron-right"></i>
                                        </a>
                                        <% } %>
                                
                            </div>
                        </div>
                    <% }) %>
                </div>
                <!-- pagination -->
                <div class="pagination">
                    <% if(totalPages > 1) { %>
                        <% if(currentPage > 1) { %>
                            <a href="/orders?page=<%= currentPage - 1 %>" class="pagination-button">
                                <i class="fas fa-chevron-left"></i> Previous
                            </a>
                        <% } %>

                        <% for(let i = Math.max(1, currentPage - 1); i <= Math.min(totalPages, currentPage + 1); i++) { %>
                            <a href="/orders?page=<%= i %>"
                                class="pagination-button <%= currentPage === i ? 'active' : '' %>">
                                <%= i %>
                            </a>
                        <% } %>

                        <% if(currentPage < totalPages) { %>
                            <a href="/orders?page=<%= currentPage + 1 %>" class="pagination-button">
                                Next <i class="fas fa-chevron-right"></i>
                            </a>
                        <% } %>
                    <% } %>
                </div>
            <% } else { %>
                <div class="no-orders">
                    <div class="no-orders-icon">
                        <i class="fas fa-box-open"></i>
                    </div>
                    <h3>No Orders Found</h3>
                    <p>You haven't placed any orders yet</p>
                    <a href="/products" class="browse-button">Browse Products</a>
                </div>
            <% } %>
        </div>
    </div>

    <%- include('../../views/partials/user/footer') %>

    <script>
        // // GSAP Animations
        // gsap.from(".orders-content", { 
        //     opacity: 0, 
        //     y: 50, 
        //     duration: 1, 
        //     ease: "power2.out" 
        // });
        // gsap.from(".order-card, .no-orders", { 
        //     opacity: 0, 
        //     y: 30, 
        //     duration: 0.8, 
        //     delay: 0.3, 
        //     stagger: 0.2,
        //     scrollTrigger: {
        //         trigger: ".orders-card-container",
        //         start: "top 80%",
        //         toggleActions: "play none none none"
        //     }
        // });
    </script>
</body>
</html>